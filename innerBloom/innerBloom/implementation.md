# iOS App Requirements Document —「陪伴日記 Dairy」

> 用 Swift + SwiftUI + Xcode 做一個簡單日記 App：使用者快速記錄照片/影片（可選文字/語音），讓 AI 先看內容再跟使用者聊天陪伴；每次聊天結束後，自動整理成「像使用者口吻」的日記頁（含媒體＋文字總結＋標籤），之後可用「標籤圖塊」分類與回顧。

---

## 1) App Overview

這是一個給想要「快速記錄生活、又想有人陪聊」的使用者的日記 App。使用者只要選一張照片或一段影片（可加一句話或用語音說），AI 就會先理解內容，接著用連續對話的方式陪伴聊天。每次對話結束後，App 會把對話精華整理成一篇「像使用者自己寫的」日記，並把原本的照片/影片一起保存，**同時生成一組標籤**（例如：旅行/朋友/焦慮/開心）。主頁可用「標籤圖塊」快速選取要回憶的分類，方便翻找。

---

## 2) Main Goals

1. 讓使用者用最少步驟新增一篇「媒體日記」。
2. 在同一頁完成「上傳媒體 + 輸入（語音/文字）+ AI 陪聊」，聊天是連續的（不會每次都像重新開始）。
3. 每次結束保存後，自動生成一篇「使用者口吻」的日記總結，**並附上標籤**，存到日記列表。
4. 使用者可以用「標籤圖塊」分類回憶，快速回頭瀏覽、搜尋、查看過去的日記頁。
5. App 使用起來簡單、穩定，離線時也不會壞掉（至少能先存草稿或提示稍後再試）。

---

## 3) User Stories

- **US-001**：作為使用者，我想要快速選擇一張照片或影片並儲存，這樣我可以不用打很多字也能記錄生活。  
- **US-002**：作為使用者，我想要（可選）加上一句簡短文字，這樣 AI 更懂我當下想表達什麼。  
- **US-003**：作為使用者，我想要用語音輸入我的想法，這樣我更省力、更自然。  
- **US-004**：作為使用者，我想要 AI 看完照片/影片後在同一頁跟我聊，這樣流程不會被切斷。  
- **US-005**：作為使用者，我想要聊天是連續的，這樣我隔天接著聊也不會斷掉情緒。  
- **US-006**：作為使用者，我想要每次聊完「結束保存」就自動產生日記總結，這樣我不用自己整理。  
- **US-007**：作為使用者，我想要總結時自動帶上標籤，這樣我回頭找回憶更快。  
- **US-008**：作為使用者，我想要用標籤圖塊選取要回憶的分類，這樣我能按主題翻日記。  
- **US-009**：作為使用者，我想要搜尋以前的日記（例如用關鍵字或日期），這樣我能快速找到那篇。  
- **US-010**：作為使用者，我想要在網路不穩時也能先保存，這樣我不會因為失敗而失去記錄。  
- **US-011**：作為使用者，我想在主頁由右往左滑就能快速新增日記，這樣我記錄更順手。  

---

## 4) Features

### 新增與輸入

- **F-001：新增日記（選照片/影片）**
  - **做什麼**：讓使用者從相簿選擇 1 個照片或 1 個影片，建立一篇新的日記「草稿」。
  - **何時出現**：主頁「右→左滑」或「＋」按鈕（備援）。
  - **出錯怎麼辦**：  
    - 沒選到媒體：提示「請先選擇照片或影片」。  
    - 影片太大或讀取失敗：提示「影片讀取失敗，請換一段或稍後再試」。

- **F-002：文字輸入（可選）**
  - **做什麼**：輸入一小段文字（例如心情、發生什麼事）。
  - **何時出現**：在主頁同頁操作（見 S-001/S-003 合併頁），媒體下方顯示文字框。
  - **出錯怎麼辦**：文字太長就提示「文字太長，請簡短一點」（並限制字數）。

- **F-011：語音輸入**
  - **做什麼**：按一下麥克風開始說話，把語音轉成文字，放進輸入框（可再編輯）。
  - **何時出現**：媒體下方、文字框附近（見 S-001/S-003 合併頁）。
  - **出錯怎麼辦**：  
    - 沒授權麥克風：提示「需要麥克風權限才能語音輸入」並引導去設定。  
    - 辨識失敗：提示「聽不清楚，請再試一次」。

### AI 理解與陪聊

- **F-003：AI 分析照片/影片內容**
  - **做什麼**：把媒體內容交給 AI 產生「它看到了什麼」的理解，用來當聊天背景。
  - **何時出現**：選完媒體後，自動或在第一次送出訊息前觸發（二選一，第一版建議：第一次送出才觸發）。
  - **出錯怎麼辦**：  
    - 沒網路/失敗：提示「目前無法分析，已先保存草稿，稍後可再試」。  
    - AI 回來的內容怪怪的：提供「重新分析」按鈕。

- **F-004：連續聊天（同一篇日記內）**
  - **做什麼**：在同一篇日記裡跟 AI 來回聊天，AI 回覆要承接前文。
  - **何時出現**：同頁面中，在媒體區上方或下方呈現訊息列表（依版面決定）。
  - **出錯怎麼辦**：  
    - 發送失敗：顯示「傳送失敗，點一下重試」。  
    - AI 太久沒回：顯示「正在等回覆…」並可取消。

- **F-005：結束保存（生成總結 + 生成標籤）**
  - **做什麼**：使用者按「結束保存」後：
    1) AI 把這次聊天整理成一篇日記（用使用者口吻）  
    2) **同時產生 3~8 個標籤**（例如：旅行/朋友/焦慮/開心）  
    3) 把媒體 + 總結 + 標籤一起存檔
  - **何時出現**：同頁面底部，與「取消」並列。
  - **出錯怎麼辦**：  
    - 生成失敗：提示「總結/標籤生成失敗，但聊天已保存。可稍後再生成。」並提供「再試一次」。  
    - 存檔失敗：提示「保存失敗，請稍後再試」，並保留草稿不丟失。

### 日記回顧與搜尋（標籤化回憶）

- **F-006：日記列表（時間排序，並跟標籤分類連動）**
  - **做什麼**：顯示日記（縮圖＋日期＋一句摘要），內容會依「目前選取的標籤分類」切換。
  - **何時出現**：主頁列表區。
  - **出錯怎麼辦**：  
    - 列表讀不到資料：顯示空狀態「目前還沒有日記」。  
    - 該標籤沒有日記：顯示空狀態「這個分類還沒有日記」。

- **F-007：日記詳情頁（媒體＋日記總結＋標籤＋聊天紀錄）**
  - **做什麼**：打開某篇日記後可看照片/影片、AI 生成的日記內容、**標籤**，也可查看聊天訊息。
  - **何時出現**：點主頁列表的某一篇。
  - **出錯怎麼辦**：媒體載入失敗：顯示「媒體無法播放」，但仍顯示文字內容。

- **F-008：搜尋與篩選（與標籤一起工作）**
  - **做什麼**：用關鍵字搜尋日記內容（例如總結文字、使用者輸入）。
  - **何時出現**：主頁上方搜尋框。
  - **規則**：  
    - 若目前選的是某個標籤：只搜尋該標籤內的日記  
    - 若目前選的是「全部」：搜尋所有日記
  - **出錯怎麼辦**：沒有結果：顯示「找不到符合的日記」。

### 主頁回憶分類與手勢（標籤圖塊）

- **F-009：標籤圖塊選取回憶分類（主頁核心）**
  - **做什麼**：主頁上方顯示一組「標籤圖塊」（chips/tiles），點選後切換回憶分類。
  - **何時出現**：主頁一進來就看到（至少顯示：全部 + 最近常用標籤）。
  - **出錯怎麼辦**：  
    - 沒有任何標籤：只顯示「全部」  
    - 點了標籤但沒內容：顯示空狀態「這個分類還沒有日記」

- **F-010：主頁右→左滑快速新增**
  - **做什麼**：使用者在主頁往右→左滑，進入「新增/聊天同頁」開始建立新日記。
  - **何時出現**：只在主頁生效。
  - **出錯怎麼辦**：  
    - 使用者誤觸：可按「取消」回主頁，不產生垃圾資料  
    - （可選）第一次使用時顯示小提示：例如「左滑可新增日記」

---

## 5) Screens

- **S-001：主頁 + 新增/聊天同頁**
  - **核心想法**：在同一頁完成「回憶分類選取 + 列表回顧 + 新增媒體 + 文字/語音輸入 + AI 聊天 + 結束保存」  
  - **畫面內容（由上到下）**：
    1. **標籤圖塊區（回憶分類）**：點圖塊切換分類（F-009）
    2. **日記列表（直向）**：顯示目前標籤分類下的日記（F-006）
    3. **頁面正中間：媒體區（照片/影片）**
       - 新增模式：顯示媒體預覽（若還沒選媒體，顯示「選擇照片/影片」引導）
    4. **媒體下方：語音輸入按鈕 + 文字輸入框**
       - 語音按鈕：一鍵說話轉文字（F-011）
       - 文字框：可輸入/可編輯
    5. **再往下：兩個並列按鈕**
       - 左：**取消**（放棄本次新增/聊天，回到純回憶瀏覽狀態）
       - 右：**結束保存**（生成總結+標籤並保存，F-005）
    6. **（输入对话时）**：在媒體區正中间顯示聊天訊息（F-004）

  - **怎麼來**：App 開啟即進入。
  - **可去**：  
    - 右→左滑（F-010）→ 仍在本頁，但切換成「新增/聊天模式」（顯示媒體區、輸入區、按鈕）  
    - 點某篇日記 → S-003  
    - 點標籤圖塊 → 仍在本頁（切換列表內容）

- **S-002：日記詳情（媒體 + 日記總結 + 標籤 + 聊天紀錄）**
  - **畫面內容**：  
    - 照片/影片播放器  
    - **標籤區（圖塊）**：顯示這篇日記的標籤，可點一下跳回主頁並套用該標籤分類
    - AI 日記總結全文  
    - （可折疊）聊天紀錄
    - 有月历点击直接转跳到日期
  - **怎麼來**：從主頁列表點某篇日記。
  - **可去**：返回 → S-001（回到原本標籤分類狀態）。

- **S-003：設定（可選，第一版可先不做）**
  - **畫面內容**：AI 口吻偏好（溫柔/理性/朋友感）、是否自動生成標題、隱私說明、（未來）語言選擇。
  - **怎麼來**：主頁右上角齒輪。
  - **可去**：返回主頁。

---

## 6) Data

- **D-001：日記清單**  
  每篇日記的：id、日期時間、縮圖、媒體類型（照片/影片）、媒體檔案位置。

- **D-002：使用者輸入內容（文字/語音轉文字）**  
  使用者輸入的一段短文字（包含語音轉文字後的結果）。

- **D-003：聊天訊息**  
  每則訊息的：誰說的（使用者/AI）、內容、時間。

- **D-004：AI 分析結果**  
  AI 對照片/影片「看到了什麼」的文字描述（作為聊天背景）。

- **D-005：日記總結（使用者口吻）**  
  每次「結束保存」產生的文章內容（可含標題、重點、情緒語氣）。

- **D-006：狀態**  
  例如：是否已分析、是否已生成總結、是否保存完成、最後一次錯誤訊息（用來顯示提示）。

- **D-007：設定（可選）**  
  例如：AI 口吻選擇、是否自動生成標題、是否跟隨系統深色模式、（未來）語言設定。

- **D-008：標籤清單（新增）**  
  標籤的：id、名稱、排序、（可選）顏色/圖示、是否為系統預設（如「全部」）。

- **D-009：日記的標籤（新增）**  
  每篇日記對應的標籤列表（例如：["旅行","朋友","放鬆"]）。  
  - 第一版建議：每篇日記先產生 3~8 個標籤  
  - 主頁圖塊顯示：最近常用/出現頻率高的標籤（簡化做法：先只顯示固定前 N 個）

---

## 7) Extra Details

1. **需要網路嗎？**  
   - AI 分析與聊天需要網路。  
   - 沒網路時，至少能先建立日記草稿（保存媒體與輸入內容）。

2. **資料存哪裡？**  
   - 第一版先「存在手機裡」（本機儲存）。  
   - 之後如果要跨手機同步，再加雲端帳號（第二階段再做）。

3. **需要哪些 iPhone 權限？**  
   - 相簿權限：選照片/影片。  
   - **麥克風權限**：語音輸入需要。  
   - （可選）相機：如果未來要直接拍攝或錄影，第一版可不做。

4. **深色模式？**  
   - 需要支援，至少跟隨系統（自動切換）。

5. **隱私提示（要顯示在 App 內）**  
   - 清楚告知：媒體與文字/語音內容可能會送去 AI 服務做分析/聊天（若你用的是雲端 AI），使用者需同意才開始。

6. **後續擴展：多語言（新增）**  
   - 第一版可先只做繁体中文。  
   - 後續要能擴展成多語言：介面文字、按鈕、提示語、空狀態文案都要能切換語言。  
   - AI 的總結與聊天語言要跟著使用者選擇（例如：简体中文/英文/日文）。

---

## 8) Build Steps

- **B-001**：先做合併後的主頁骨架（S-001）  
  - 做出：搜尋框 + 標籤圖塊區（假資料）+ 日記列表空狀態  
  - 同步完成：**F-006（空狀態）+ F-009（標籤圖塊 UI）**

- **B-002**：在同一頁加入「新增/聊天模式」的版面  
  - 做出：媒體區（正中間）+ 語音按鈕 + 文字輸入框 + 取消/結束保存並列按鈕  
  - 先不接 AI，先能切換模式與輸入

- **B-003**：加上主頁「右→左滑」進新增模式（F-010）  
  - 右→左滑後：顯示媒體區與輸入區  
  - 按「取消」回到純回憶瀏覽狀態（不產生垃圾資料）

- **B-004**：做選媒體與本機保存草稿  
  - 完成：**F-001**（選照片/影片）+ **D-001**（日記基本資料）+ **D-002**（使用者輸入）  
  - 新增完成後，列表會更新（至少在「全部」看得到）

- **B-005**：加入語音輸入（F-011）  
  - 取得麥克風權限  
  - 語音轉文字寫進輸入框  
  - 失敗時提示與可重試

- **B-006**：加入聊天訊息區（先假資料）  
  - 完成：**F-004（同頁對話 UI）+ D-003（本機存訊息）**

- **B-007**：接 AI 分析（F-003）  
  - 第一次送出或開始聊天時做分析  
  - 存 **D-004**  
  - 失敗時提示並保留草稿

- **B-008**：接 AI 連續聊天（F-004 真正接通）  
  - 每次對話都承接同一篇日記的背景（D-004）與歷史訊息（D-003）

- **B-009**：實作「結束保存」（F-005：總結 + 標籤）  
  - 按「結束保存」→ AI 生成總結（D-005）+ 標籤（D-009）  
  - 保存成功後回到列表瀏覽狀態，並可點進詳情 S-004

- **B-010**：做日記詳情頁（S-004，含標籤顯示）  
  - 顯示媒體 + 標籤圖塊 + 總結 +（可折疊）聊天紀錄

- **B-011**：讓列表依標籤切換內容  
  - 完成：**D-008/D-009** 與 **F-006（標籤連動版）**  
  - 點標籤圖塊就能看到該分類回憶

- **B-012**：主頁搜尋（F-008，與標籤一起工作）  
  - 在目前標籤範圍內搜尋（或「全部」搜尋全域）

- **B-013**：補齊錯誤處理與體驗  
  - 依各 Feature 的「出錯怎麼辦」補提示、重試、空狀態、載入中狀態

- **B-014**：深色模式與多語言預留（Extra Details #4/#6）  
  - 先跟隨系統深色模式  
  - 把介面文字整理成「可替換的文字資源」，為未來多語言做準備